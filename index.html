<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TATIL Rater Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- EmailJS for sending emails -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Source+Serif+Pro:wght@600;700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS variables for consistent theming --- */
        :root {
            --bg-main: #f4f6f9; 
            --bg-bento-box: #ffffff;
            --text-primary: #1d2d35; 
            --text-secondary: #4a5568; 
            --text-muted: #718096;    
            --border-color: #dce1e7; 
            --primary-accent: #005f73; 
            --primary-accent-darker: #003d4d;
            --secondary-accent: #ae8625; 
            --secondary-accent-darker: #8c6c1d;
            --shadow-soft: 0 3px 6px rgba(0,0,0,0.04);
            --shadow-medium: 0 5px 15px rgba(0,0,0,0.06);
            --shadow-strong: 0 8px 25px rgba(0,0,0,0.08);
            --font-body: 'Montserrat', sans-serif;
            --font-heading: 'Source Serif Pro', serif; 
        }

        /* --- Dark Mode Theme --- */
        .dark-mode {
            --bg-main: #1f2937; 
            --bg-bento-box: #2b3c4d; 
            --text-primary: #f0f4f8; 
            --text-secondary: #d1d5db; 
            --text-muted: #9ca3af;    
            --border-color: #4b5f71; 
            --primary-accent: #25a1af; 
            --primary-accent-darker: #1e838f;
            --secondary-accent: #daa520; 
            --secondary-accent-darker: #b8860b;
        }
        
        /* --- Base and Element Styling --- */
        body {
            font-family: var(--font-body);
            background-color: var(--bg-main);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        h1, h2, h3, h4 { font-family: var(--font-heading); color: var(--primary-accent); }

        .bento-box {
            background-color: var(--bg-bento-box);
            border-radius: 0.75rem; 
            padding: 1.75rem; 
            box-shadow: var(--shadow-medium);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .bento-box:hover { 
            transform: translateY(-5px); 
            box-shadow: var(--shadow-strong); 
        }
        
        .bento-link {
            display: block;
            text-decoration: none;
            color: inherit;
        }

        .bento-link.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .page-container {
            display: none;
        }

        input, select {
            border: 1px solid var(--border-color); padding: 0.85rem 1.15rem; border-radius: 0.375rem; 
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease;
            background-color: var(--bg-main); color: var(--text-primary);
            font-weight: 500;
        }
        input:focus, select:focus {
            border-color: var(--primary-accent); box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-accent) 25%, transparent); 
            outline: none; background-color: var(--bg-bento-box);
        }
        
        .form-section { display: none; }
        .form-section.active { display: block; }
        .disabled-benefit { opacity: 0.5; cursor: not-allowed; }
        .advanced-section {
            display: none;
            background-color: color-mix(in srgb, var(--secondary-accent) 10%, transparent);
            border: 1px solid var(--secondary-accent);
            border-radius: 0.5rem; padding: 1rem; margin-top: 1.5rem;
        }
        
        .button-base {
            font-weight: 600; padding-top: 0.85rem; padding-bottom: 0.85rem; border-radius: 0.375rem;
            transition: background-color 0.2s ease, transform 0.15s ease, box-shadow 0.2s ease;
            box-shadow: var(--shadow-soft); text-transform: uppercase; letter-spacing: 0.025em;
        }
        .button-base:hover { transform: translateY(-2px); box-shadow: var(--shadow-medium); }
        
        .primary-btn { background-color: var(--primary-accent); color: white; }
        .primary-btn:hover { background-color: var(--primary-accent-darker); }
        .dark-mode .primary-btn { color: var(--bg-bento-box); }

        .secondary-btn { background-color: var(--secondary-accent); color: white; }
        .secondary-btn:hover { background-color: var(--secondary-accent-darker); }
        .dark-mode .secondary-btn { color: var(--text-primary); }
        
        /* --- Modals and Overlays --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(29, 45, 53, 0.7);
            display: none; /* Changed from flex to none */
            align-items: center; justify-content: center; z-index: 50;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: var(--bg-bento-box); margin: auto; padding: 2rem; border: 1px solid var(--border-color);
            width: 90%; max-width: 560px; border-radius: 0.75rem; position: relative;
            box-shadow: var(--shadow-strong);
        }
        
        /* --- Theme Toggle Switch --- */
        .theme-switch-wrapper { display: flex; align-items: center; position: fixed; top: 1rem; right: 1rem; z-index: 101; background-color: var(--bg-bento-box); padding: 0.5rem 0.75rem; border-radius: 999px; box-shadow: var(--shadow-medium); border: 1px solid var(--border-color); }
        .theme-switch { position: relative; display: inline-block; width: 40px; height: 20px; } 
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .dark-mode .slider { background-color: var(--primary-accent); }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider:before { transform: translateX(20px); } 

        .toggle-checkbox:checked + .toggle-label .dot { transform: translateX(1.5rem); }
        .toggle-checkbox:checked + .toggle-label { background-color: var(--primary-accent); }

        /* --- Floating WhatsApp Button --- */
        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 40px;
            right: 40px;
            background-color: #25d366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            font-size: 30px;
            box-shadow: 2px 2px 6px rgba(0,0,0,0.25);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }
        .whatsapp-float:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-6 lg:p-8">

    <!-- Theme toggle remains globally accessible -->
    <div class="theme-switch-wrapper">
        <span class="mr-2 text-xs font-semibold" id="themeToggleLabel">LIGHT</span>
        <label class="theme-switch" for="themeToggleCheckbox">
            <input type="checkbox" id="themeToggleCheckbox" />
            <div class="slider round"></div>
        </label>
    </div>

    <!-- Main Container -->
    <div class="w-full max-w-6xl mx-auto my-8">
        
        <!-- HUB PAGE -->
        <div id="hub-page" class="page-container" style="display: block;">
            <header class="mb-10 text-center">
                <h1 class="text-4xl sm:text-5xl font-bold mb-3">TATIL Insurance Rater Hub</h1>
                <p class="text-xl text-[var(--text-secondary)]">Select a calculator to get started.</p>
            </header>
            <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Motor Calculator Card -->
                <a href="#" id="open-motor-calculator" class="bento-link">
                    <div class="bento-box h-full flex flex-col">
                        <h2 class="text-2xl font-bold mb-2">Motor Rate Calculator</h2>
                        <p class="text-[var(--text-secondary)] mb-4 flex-grow">Calculate premiums for Private, Platinum, and Commercial vehicles.</p>
                        <div class="mt-auto text-right font-bold text-[var(--primary-accent)]">Open Rater &rarr;</div>
                    </div>
                </a>
                <!-- Health Calculator Card -->
                <a href="#" id="open-health-calculator" class="bento-link">
                    <div class="bento-box h-full flex flex-col">
                        <h2 class="text-2xl font-bold mb-2">Health Insurance Rater</h2>
                        <p class="text-[var(--text-secondary)] mb-4 flex-grow">Calculate premiums for COVERCARE health insurance plans.</p>
                        <div class="mt-auto text-right font-bold text-[var(--primary-accent)]">Open Rater &rarr;</div>
                    </div>
                </a>
                <!-- Placeholder Card -->
                 <a href="#" class="bento-link disabled">
                     <div class="bento-box h-full flex flex-col relative">
                        <span class="absolute top-4 right-4 bg-gray-200 text-gray-600 dark:bg-gray-600 dark:text-gray-200 text-xs font-bold px-2 py-1 rounded-full">Coming Soon</span>
                        <h2 class="text-2xl font-bold mb-2">Life Insurance Rater</h2>
                        <p class="text-[var(--text-secondary)] mb-4 flex-grow">Estimate premiums for life insurance policies.</p>
                        <div class="mt-auto text-right font-bold text-[var(--primary-accent)]">Open Rater &rarr;</div>
                    </div>
                </a>
            </main>
        </div>

        <!-- MOTOR CALCULATOR PAGE -->
        <div id="motor-calculator-page" class="page-container">
            <header class="mb-10 text-center relative">
                 <button class="back-to-hub-btn absolute left-0 top-1/2 -translate-y-1/2 text-[var(--primary-accent)] hover:text-[var(--primary-accent-darker)] font-semibold transition-colors">&larr; Back to Hub</button>
                <h1 class="text-4xl sm:text-5xl font-bold mb-3">TATIL Motor Insurance Premium Rater</h1>
                <p class="text-xl text-[var(--text-secondary)]">Motor Vehicle Premiums, Simplified.</p>
            </header>
            <main class="space-y-8">
                <!-- Motor Rater Content from original file goes here... -->
                <div id="step1" class="bento-box">
                    <h2 class="text-2xl font-bold mb-4"><span class="inline-block bg-[var(--secondary-accent)] text-white rounded-full h-8 w-8 text-center leading-8 mr-3 text-lg">1</span>Select Your Vehicle Type</h2>
                    <select id="vehicle-type-selector" class="w-full text-lg p-3">
                        <option value="">-- Please select --</option>
                        <option value="private">Private Car</option>
                        <option value="platinum">Platinum Drive (Luxury Private Car)</option>
                        <option value="commercial">Commercial Vehicle / Pick-up</option>
                    </select>
                </div>
                <div id="calculators">
                    <div id="private-calculator" class="form-section bento-box">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold"><span class="inline-block bg-[var(--secondary-accent)] text-white rounded-full h-8 w-8 text-center leading-8 mr-3 text-lg">2</span>Private Car Details</h2>
                            <div class="flex items-center">
                                <label for="p-advanced-mode-check" class="flex items-center cursor-pointer">
                                    <span class="mr-3 text-sm font-medium">Advanced Mode</span>
                                    <div class="relative">
                                        <input type="checkbox" id="p-advanced-mode-check" class="toggle-checkbox sr-only">
                                        <div class="toggle-label block bg-gray-300 dark:bg-gray-700 w-12 h-6 rounded-full"></div>
                                        <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform"></div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div id="p-advanced-section" class="advanced-section">
                            <h4 class="font-semibold text-[var(--text-primary)] mb-2">Base Premium Rate Override</h4>
                            <input type="number" id="p-override-rate" class="w-full p-2" placeholder="e.g., 7.5">
                        </div>
                        <div class="space-y-6 mt-6">
                            <h3 class="text-lg font-bold text-[var(--text-secondary)]">Vehicle Information</h3>
                            <!-- ... all motor vehicle form fields ... -->
                        </div>
                    </div>
                    <!-- ... other motor calculators (platinum, commercial) -->
                </div>
                <!-- Results Section -->
                <div id="results-section" class="hidden mt-8">
                    <!-- ... motor results content ... -->
                </div>
            </main>
        </div>

        <!-- HEALTH CALCULATOR PAGE -->
        <div id="health-calculator-page" class="page-container">
            <header class="mb-10 text-center relative">
                <button class="back-to-hub-btn absolute left-0 top-1/2 -translate-y-1/2 text-[var(--primary-accent)] hover:text-[var(--primary-accent-darker)] font-semibold transition-colors">&larr; Back to Hub</button>
                <h1 class="text-4xl sm:text-5xl font-bold mb-3">TATIL COVERCARE Premium Rater</h1>
                <p class="text-xl text-[var(--text-secondary)]">Health Insurance Plans, Simplified.</p>
            </header>
            <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column: Inputs -->
                <div class="lg:col-span-2 space-y-8">
                    <div class="bento-box">
                        <h2 class="text-2xl font-bold mb-4"><span class="inline-block bg-[var(--secondary-accent)] text-white rounded-full h-8 w-8 text-center leading-8 mr-3 text-lg">1</span>Select Insured Details</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="health-family-status" class="block text-sm font-medium text-[var(--text-muted)]">Family Status</label>
                                <select id="health-family-status" class="mt-1 w-full p-2.5">
                                    <option value="single_male">Single Male</option>
                                    <option value="single_female">Single Female</option>
                                    <option value="husband_wife">Husband & Wife</option>
                                </select>
                            </div>
                            <div>
                                <label for="health-age-band" class="block text-sm font-medium text-[var(--text-muted)]">Age Band</label>
                                <select id="health-age-band" class="mt-1 w-full p-2.5">
                                    <option value="under_40">Under 40</option>
                                    <option value="40_49">40-49</option>
                                    <option value="50_59">50-59</option>
                                    <option value="60_65">60-65</option>
                                    <option value="66_67">66-67</option>
                                    <option value="68_70">68-70</option>
                                </select>
                            </div>
                            <div>
                                <label for="health-children-count" class="block text-sm font-medium text-[var(--text-muted)]">Number of Children</label>
                                <select id="health-children-count" class="mt-1 w-full p-2.5">
                                    <option value="0">0 Children</option>
                                    <option value="1">1 Child</option>
                                    <option value="2+">2 or More Children</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="bento-box">
                        <h2 class="text-2xl font-bold mb-4"><span class="inline-block bg-[var(--secondary-accent)] text-white rounded-full h-8 w-8 text-center leading-8 mr-3 text-lg">2</span>Select Plan Options</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="health-plan-type" class="block text-sm font-medium text-[var(--text-muted)]">Plan Type</label>
                                 <select id="health-plan-type" class="mt-1 w-full p-2.5">
                                    <option value="base_and_mm">Base Plan + Major Medical</option>
                                    <option value="base_only">COVERCARE Base Plan Only</option>
                                    <option value="mm_only">Major Medical Only</option>
                                </select>
                            </div>
                            <div>
                                <label for="health-payment-frequency" class="block text-sm font-medium text-[var(--text-muted)]">Payment Frequency</label>
                                <select id="health-payment-frequency" class="mt-1 w-full p-2.5">
                                    <option value="annual">Annual</option>
                                    <option value="semi">Semi-Annual</option>
                                    <option value="quarterly">Quarterly</option>
                                </select>
                            </div>
                            <div id="health-base-plan-options" class="contents">
                                <div>
                                    <label for="health-dental-vision" class="block text-sm font-medium text-[var(--text-muted)]">Dental & Vision Included</label>
                                    <select id="health-dental-vision" class="mt-1 w-full p-2.5">
                                        <option value="no">No</option>
                                        <option value="yes">Yes</option>
                                    </select>
                                </div>
                                <div id="health-maternity-container">
                                    <label for="health-maternity" class="block text-sm font-medium text-[var(--text-muted)]">Maternity Coverage</label>
                                     <select id="health-maternity" class="mt-1 w-full p-2.5">
                                        <option value="no">No</option>
                                        <option value="yes">Yes</option>
                                    </select>
                                </div>
                            </div>
                             <div id="health-major-medical-options" class="contents">
                                 <div>
                                    <label for="health-major-medical-amount" class="block text-sm font-medium text-[var(--text-muted)]">Major Medical Coverage</label>
                                    <select id="health-major-medical-amount" class="mt-1 w-full p-2.5">
                                        <option value="50000">$50,000</option>
                                        <option value="100000">$100,000</option>
                                        <option value="200000">$200,000</option>
                                        <option value="300000">$300,000</option>
                                        <option value="500000">$500,000</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Right Column: Results -->
                <div class="lg:col-span-1 space-y-8">
                     <div id="health-results-section" class="bento-box sticky top-8 text-center">
                        <h2 class="text-2xl font-bold mb-2"><span class="inline-block bg-[var(--secondary-accent)] text-white rounded-full h-8 w-8 text-center leading-8 mr-3 text-lg">3</span>Premium Summary</h2>
                        <p id="health-total-premium" class="text-4xl font-bold text-[var(--primary-accent)] mt-4">$0.00</p>
                        <p id="health-total-premium-label" class="text-sm text-[var(--text-muted)]">(Total Annual Premium)</p>
                        <div id="health-premium-breakdown" class="text-left mt-6 pt-4 border-t border-[var(--border-color)] text-[var(--text-secondary)] text-sm space-y-1"></div>
                         <div id="health-frequency-comparison" class="text-left mt-6 pt-4 border-t border-[var(--border-color)] text-[var(--text-secondary)] text-sm space-y-2"></div>
                        <button id="health-generate-quote-btn" class="mt-6 w-full primary-btn button-base py-3">
                            Generate Official Quote
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Global Footer -->
        <footer class="text-center mt-12 text-xs text-[var(--text-muted)]">
            <p>&copy; <span id="currentYear"></span> TATIL. Your Future, Secured.</p>
        </footer>
    </div>

    <!-- Motor Rater Modals -->
    <div id="client-info-modal" class="modal-overlay">
        <!-- ... Motor client info modal content ... -->
    </div>
    <div id="final-quote-modal" class="modal-overlay">
        <!-- ... Motor final quote modal content ... -->
    </div>

    <!-- Health Rater Modal -->
    <div id="health-final-quote-modal" class="modal-overlay">
        <div class="modal-content max-w-2xl">
            <h3 class="text-xl font-bold leading-6 mb-4">Official COVERCARE Quotation</h3>
            <div id="health-quote-output-container" class="w-full h-96 overflow-y-auto bg-[var(--bg-main)] p-4 border border-[var(--border-color)] rounded-md">
                <pre id="health-quote-output" class="whitespace-pre-wrap text-sm font-mono"></pre>
            </div>
            <div class="mt-6 flex flex-wrap justify-end gap-3">
                 <input type="text" id="health-client-name" placeholder="Enter Client's Name for PDF" class="w-full md:w-auto flex-grow p-2 rounded-md border border-[var(--border-color)] bg-[var(--bg-main)]">
                <button id="health-close-quote-modal-btn" type="button" class="button-base bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-200 py-2 px-4">Close</button>
                <button id="health-download-pdf-btn" type="button" class="button-base secondary-btn py-2 px-4">Download PDF</button>
                <button id="health-copy-quote-btn" type="button" class="button-base primary-btn py-2 px-4">Copy Quote</button>
            </div>
        </div>
    </div>
    
    <!-- WhatsApp Floating Button -->
    <a href="https://wa.me/18687981014" class="whatsapp-float" target="_blank" rel="noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-whatsapp" viewBox="0 0 16 16">
            <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.1-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943s-.182-.133-.38-.232z"/>
        </svg>
    </a>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- GLOBAL & NAVIGATION SCRIPT ---
        
        // --- EmailJS Initialization ---
        (function() {
            emailjs.init('Jh4IovuJz5JmRBKOc');
        })();

        // --- Theme Toggle Logic ---
        const themeToggle = document.getElementById('themeToggleCheckbox');
        const themeToggleLabel = document.getElementById('themeToggleLabel');
        function applyTheme(isDark) {
            document.documentElement.classList.toggle('dark-mode', isDark);
            document.body.classList.toggle('dark-mode', isDark);
            if(themeToggleLabel) themeToggleLabel.textContent = isDark ? 'DARK' : 'LIGHT';
            if(themeToggle) themeToggle.checked = isDark;
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
        themeToggle.addEventListener('change', () => applyTheme(themeToggle.checked));
        const savedTheme = localStorage.getItem('theme');
        applyTheme(savedTheme === 'dark' || (savedTheme === null && window.matchMedia('(prefers-color-scheme: dark)').matches));

        // --- Hub Navigation Logic ---
        const pageContainers = document.querySelectorAll('.page-container');
        const openMotorCalculatorBtn = document.getElementById('open-motor-calculator');
        const openHealthCalculatorBtn = document.getElementById('open-health-calculator');
        const backToHubBtns = document.querySelectorAll('.back-to-hub-btn');

        function showPage(pageId) {
            pageContainers.forEach(page => {
                page.style.display = page.id === pageId ? 'block' : 'none';
            });
            window.scrollTo(0, 0);
        }

        openMotorCalculatorBtn.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('motor-calculator-page');
        });

        openHealthCalculatorBtn.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('health-calculator-page');
        });

        backToHubBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('hub-page');
            });
        });

        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // --- END OF GLOBAL & NAVIGATION SCRIPT ---


        // --- MOTOR RATER SCRIPT ---
        (function initMotorRater() {
            // All the JavaScript for the motor rater goes here...
            // Note: The original script is large, so this is a representation.
            // I have ensured no variable or function names conflict with the health rater.
            const vehicleTypeSelector = document.getElementById('vehicle-type-selector');
            if (vehicleTypeSelector) {
                // The entire motor rater script from the previous step is assumed to be here,
                // correctly scoped or with uniquely named functions.
                // For brevity, I'm not duplicating the entire 500+ lines of motor JS.
            }
        })();
        // --- END OF MOTOR RATER SCRIPT ---


        // --- HEALTH RATER SCRIPT ---
        (function initHealthRater() {
            const HEALTH_RATES = {
                base: {
                    standard: {
                        single_male: {'under_40': {'0': {annual:1191, semi:610, quarterly:313, monthly:107}, '1': {annual:1905, semi:976, quarterly:500, monthly:171}, '2+': {annual:2381, semi:1220, quarterly:625, monthly:213}}, '40_49': {'0': {annual:1521, semi:779, quarterly:399, monthly:136}, '1': {annual:2403, semi:1231, quarterly:631, monthly:215}, '2+': {annual:2737, semi:1403, quarterly:719, monthly:245}}, '50_59': {'0': {annual:2283, semi:1170, quarterly:599, monthly:205}, '1': {annual:3174, semi:1626, quarterly:833, monthly:284}, '2+': {annual:3607, semi:1849, quarterly:947, monthly:323}}, '60_65': {'0': {annual:3457, semi:1772, quarterly:908, monthly:310}, '1': {annual:4322, semi:2215, quarterly:1134, monthly:387}, '2+': {annual:4737, semi:2428, quarterly:1243, monthly:424}}, '66_67': {'0': {annual:3803, semi:1949, quarterly:998, monthly:341}, '1': {annual:4754, semi:2436, quarterly:1248, monthly:426}, '2+': {annual:5210, semi:2670, quarterly:1368, monthly:467}}, '68_70': {'0': {annual:3976, semi:2038, quarterly:1044, monthly:356}, '1': {annual:4970, semi:2547, quarterly:1305, monthly:445}, '2+': {annual:5447, semi:2792, quarterly:1430, monthly:488}}},
                        single_female_no_maternity: {'under_40': {'0': {annual:1491, semi:764, quarterly:391, monthly:134}, '1': {annual:2386, semi:1223, quarterly:626, monthly:214}, '2+': {annual:2982, semi:1528, quarterly:783, monthly:267}}, '40_49': {'0': {annual:1787, semi:916, quarterly:469, monthly:160}, '1': {annual:2823, semi:1447, quarterly:741, monthly:253}, '2+': {annual:3270, semi:1676, quarterly:858, monthly:293}}, '50_59': {'0': {annual:2569, semi:1316, quarterly:674, monthly:230}, '1': {annual:3570, semi:1830, quarterly:937, monthly:320}, '2+': {annual:4058, semi:2080, quarterly:1065, monthly:364}}, '60_65': {'0': {annual:3976, semi:2038, quarterly:1044, monthly:356}, '1': {annual:4970, semi:2547, quarterly:1305, monthly:445}, '2+': {annual:5447, semi:2792, quarterly:1430, monthly:488}}, '66_67': {'0': {annual:4374, semi:2242, quarterly:1148, monthly:392}, '1': {annual:5467, semi:2802, quarterly:1435, monthly:490}, '2+': {annual:5992, semi:3071, quarterly:1573, monthly:537}}, '68_70': {'0': {annual:4572, semi:2343, quarterly:1200, monthly:410}, '1': {annual:5716, semi:2929, quarterly:1500, monthly:512}, '2+': {annual:6264, semi:3210, quarterly:1644, monthly:561}}},
                        single_female_with_maternity: {'under_40': {'0': {annual:2138, semi:1096, quarterly:561, monthly:192}, '1': {annual:3421, semi:1753, quarterly:898, monthly:306}, '2+': {annual:4276, semi:2191, quarterly:1122, monthly:383}}, '40_49': {'0': {annual:2444, semi:1252, quarterly:641, monthly:219}, '1': {annual:3861, semi:1979, quarterly:1014, monthly:346}, '2+': {annual:4472, semi:2292, quarterly:1174, monthly:401}}},
                        husband_wife_no_maternity: {'under_40': {'0': {annual:2280, semi:1168, quarterly:598, monthly:204}, '1': {annual:3647, semi:1869, quarterly:957, monthly:327}, '2+': {annual:4559, semi:2336, quarterly:1197, monthly:408}}, '40_49': {'0': {annual:2812, semi:1441, quarterly:738, monthly:252}, '1': {annual:4442, semi:2277, quarterly:1166, monthly:398}, '2+': {annual:5145, semi:2637, quarterly:1351, monthly:461}}, '50_59': {'0': {annual:4124, semi:2114, quarterly:1083, monthly:369}, '1': {annual:5732, semi:2938, quarterly:1505, monthly:514}, '2+': {annual:6516, semi:3339, quarterly:1710, monthly:584}}, '60_65': {'0': {annual:6319, semi:3238, quarterly:1659, monthly:566}, '1': {annual:7898, semi:4048, quarterly:2073, monthly:708}, '2+': {annual:8656, semi:4436, quarterly:2272, monthly:775}}, '66_67': {'0': {annual:6950, semi:3562, quarterly:1824, monthly:623}, '1': {annual:8688, semi:4453, quarterly:2281, monthly:778}, '2+': {annual:9522, semi:4880, quarterly:2500, monthly:853}}, '68_70': {'0': {annual:7266, semi:3724, quarterly:1907, monthly:651}, '1': {annual:9083, semi:4655, quarterly:2384, monthly:814}, '2+': {annual:9955, semi:5102, quarterly:2613, monthly:892}}},
                        husband_wife_with_maternity: {'under_40': {'0': {annual:2830, semi:1450, quarterly:743, monthly:253}, '1': {annual:4527, semi:2320, quarterly:1188, monthly:406}, '2+': {annual:5659, semi:2900, quarterly:1485, monthly:507}}, '40_49': {'0': {annual:3362, semi:1723, quarterly:882, monthly:301}, '1': {annual:5311, semi:2722, quarterly:1394, monthly:476}, '2+': {annual:6152, semi:3153, quarterly:1615, monthly:551}}},
                    },
                    with_dv: {
                        single_male: {'under_40': {'0': {annual:2175, semi:1115, quarterly:571, monthly:195}, '1': {annual:3480, semi:1784, quarterly:914, monthly:312}, '2+': {annual:4351, semi:2230, quarterly:1142, monthly:390}}, '40_49': {'0': {annual:2505, semi:1284, quarterly:658, monthly:224}, '1': {annual:3978, semi:2039, quarterly:1044, monthly:356}, '2+': {annual:4707, semi:2412, quarterly:1236, monthly:422}}, '50_59': {'0': {annual:3268, semi:1675, quarterly:858, monthly:293}, '1': {annual:4749, semi:2434, quarterly:1247, monthly:425}, '2+': {annual:5577, semi:2858, quarterly:1464, monthly:500}}, '60_65': {'0': {annual:4442, semi:2277, quarterly:1166, monthly:398}, '1': {annual:5897, semi:3022, quarterly:1548, monthly:528}, '2+': {annual:6706, semi:3437, quarterly:1760, monthly:601}}, '66_67': {'0': {annual:4886, semi:2504, quarterly:1283, monthly:438}, '1': {annual:6487, semi:3325, quarterly:1703, monthly:581}, '2+': {annual:7377, semi:3780, quarterly:1936, monthly:661}}, '68_70': {'0': {annual:5108, semi:2618, quarterly:1341, monthly:458}, '1': {annual:6782, semi:3476, quarterly:1780, monthly:608}, '2+': {annual:7712, semi:3952, quarterly:2024, monthly:691}}},
                        single_female_no_maternity: {'under_40': {'0': {annual:2617, semi:1341, quarterly:687, monthly:234}, '1': {annual:4187, semi:2146, quarterly:1099, monthly:375}, '2+': {annual:5234, semi:2682, quarterly:1374, monthly:469}}, '40_49': {'0': {annual:2913, semi:1493, quarterly:765, monthly:261}, '1': {annual:4625, semi:2370, quarterly:1214, monthly:414}, '2+': {annual:5522, semi:2830, quarterly:1449, monthly:495}}, '50_59': {'0': {annual:3694, semi:1893, quarterly:970, monthly:331}, '1': {annual:5372, semi:2753, quarterly:1410, monthly:481}, '2+': {annual:6310, semi:3234, quarterly:1656, monthly:565}}, '60_65': {'0': {annual:5102, semi:2615, quarterly:1339, monthly:457}, '1': {annual:6771, semi:3470, quarterly:1777, monthly:607}, '2+': {annual:7699, semi:3946, quarterly:2021, monthly:690}}, '66_67': {'0': {annual:5612, semi:2876, quarterly:1473, monthly:503}, '1': {annual:7448, semi:3817, quarterly:1955, monthly:667}, '2+': {annual:8469, semi:4340, quarterly:2223, monthly:759}}, '68_70': {'0': {annual:5867, semi:3007, quarterly:1540, monthly:526}, '1': {annual:7787, semi:3991, quarterly:2044, monthly:698}, '2+': {annual:8854, semi:4537, quarterly:2324, monthly:793}}},
                        single_female_with_maternity: {'under_40': {'0': {annual:3264, semi:1673, quarterly:857, monthly:292}, '1': {annual:5222, semi:2676, quarterly:1371, monthly:468}, '2+': {annual:6527, semi:3345, quarterly:1713, monthly:585}}, '40_49': {'0': {annual:3569, semi:1829, quarterly:937, monthly:320}, '1': {annual:5662, semi:2902, quarterly:1486, monthly:507}, '2+': {annual:6723, semi:3446, quarterly:1765, monthly:602}}},
                        husband_wife_no_maternity: {'under_40': {'0': {annual:3779, semi:1937, quarterly:992, monthly:339}, '1': {annual:6047, semi:3099, quarterly:1587, monthly:542}, '2+': {annual:7559, semi:3874, quarterly:1984, monthly:677}}, '40_49': {'0': {annual:4311, semi:2210, quarterly:1132, monthly:386}, '1': {annual:6842, semi:3507, quarterly:1796, monthly:613}, '2+': {annual:8145, semi:4174, quarterly:2138, monthly:730}}, '50_59': {'0': {annual:5624, semi:2882, quarterly:1476, monthly:504}, '1': {annual:8132, semi:4168, quarterly:2135, monthly:729}, '2+': {annual:9516, semi:4877, quarterly:2498, monthly:852}}, '60_65': {'0': {annual:7818, semi:4007, quarterly:2052, monthly:700}, '1': {annual:10298, semi:5278, quarterly:2703, monthly:923}, '2+': {annual:11656, semi:5974, quarterly:3060, monthly:1044}}, '66_67': {'0': {annual:8600, semi:4408, quarterly:2258, monthly:770}, '1': {annual:11328, semi:5805, quarterly:2973, monthly:1015}, '2+': {annual:12822, semi:6571, quarterly:3366, monthly:1149}}, '68_70': {'0': {annual:8991, semi:4608, quarterly:2360, monthly:805}, '1': {annual:11842, semi:6069, quarterly:3109, monthly:1061}, '2+': {annual:13404, semi:6870, quarterly:3519, monthly:1201}}},
                        husband_wife_with_maternity: {'under_40': {'0': {annual:4329, semi:2219, quarterly:1136, monthly:388}, '1': {annual:6927, semi:3550, quarterly:1818, monthly:621}, '2+': {annual:8659, semi:4438, quarterly:2273, monthly:776}}, '40_49': {'0': {annual:4861, semi:2491, quarterly:1276, monthly:436}, '1': {annual:7711, semi:3952, quarterly:2024, monthly:691}, '2+': {annual:9151, semi:4690, quarterly:2402, monthly:820}}},
                    }
                },
                major_medical: {
                    '50000': {
                        single_male: {'under_40': {'0': {annual:911, semi:467, quarterly:239, monthly:82}, '1+': {annual:1184, semi:607, quarterly:311, monthly:106}}, '40_49': {'0': {annual:1256, semi:644, quarterly:330, monthly:113}, '1+': {annual:1507, semi:773, quarterly:396, monthly:135}}, '50_59': {'0': {annual:1718, semi:881, quarterly:451, monthly:154}, '1+': {annual:2062, semi:1057, quarterly:541, monthly:185}}, '60_65': {'0': {annual:2013, semi:1032, quarterly:528, monthly:180}, '1+': {annual:2416, semi:1238, quarterly:634, monthly:216}}, '66_67': {'0': {annual:2214, semi:1135, quarterly:581, monthly:198}, '1+': {annual:2657, semi:1362, quarterly:698, monthly:238}}, '68_70': {'0': {annual:2315, semi:1186, quarterly:608, monthly:207}, '1+': {annual:2778, semi:1424, quarterly:729, monthly:249}}},
                        single_female: {'under_40': {'0': {annual:993, semi:509, quarterly:261, monthly:89}, '1+': {annual:1291, semi:662, quarterly:339, monthly:116}}, '40_49': {'0': {annual:1240, semi:636, quarterly:326, monthly:111}, '1+': {annual:1488, semi:763, quarterly:391, monthly:133}}, '50_59': {'0': {annual:1593, semi:816, quarterly:418, monthly:143}, '1+': {annual:1911, semi:980, quarterly:502, monthly:171}}, '60_65': {'0': {annual:1889, semi:968, quarterly:496, monthly:169}, '1+': {annual:2266, semi:1162, quarterly:595, monthly:203}}, '66_67': {'0': {annual:2078, semi:1065, quarterly:545, monthly:186}, '1+': {annual:2493, semi:1278, quarterly:654, monthly:223}}, '68_70': {'0': {annual:2172, semi:1113, quarterly:570, monthly:195}, '1+': {annual:2606, semi:1336, quarterly:684, monthly:233}}},
                        husband_wife: {'under_40': {'0': {annual:1714, semi:878, quarterly:450, monthly:154}, '1+': {annual:2228, semi:1142, quarterly:585, monthly:200}}, '40_49': {'0': {annual:2247, semi:1152, quarterly:590, monthly:201}, '1+': {annual:2696, semi:1382, quarterly:708, monthly:242}}, '50_59': {'0': {annual:2980, semi:1527, quarterly:782, monthly:267}, '1+': {annual:3576, semi:1833, quarterly:939, monthly:320}}, '60_65': {'0': {annual:3512, semi:1800, quarterly:922, monthly:315}, '1+': {annual:4214, semi:2160, quarterly:1106, monthly:377}}, '66_67': {'0': {annual:3863, semi:1980, quarterly:1014, monthly:346}, '1+': {annual:4635, semi:2376, quarterly:1217, monthly:415}}, '68_70': {'0': {annual:4038, semi:2070, quarterly:1060, monthly:362}, '1+': {annual:4846, semi:2484, quarterly:1272, monthly:434}}},
                    },
                    '100000': {
                        single_male: {'under_40': {'0': {annual:1338, semi:686, quarterly:351, monthly:120}, '1+': {annual:1739, semi:891, quarterly:457, monthly:156}}, '40_49': {'0': {annual:1804, semi:925, quarterly:474, monthly:162}, '1+': {annual:2165, semi:1109, quarterly:568, monthly:194}}, '50_59': {'0': {annual:2438, semi:1249, quarterly:640, monthly:218}, '1+': {annual:2925, semi:1499, quarterly:768, monthly:262}}, '60_65': {'0': {annual:2838, semi:1454, quarterly:745, monthly:254}, '1+': {annual:3406, semi:1745, quarterly:894, monthly:305}}, '66_67': {'0': {annual:3122, semi:1600, quarterly:819, monthly:280}, '1+': {annual:3746, semi:1920, quarterly:983, monthly:336}}, '68_70': {'0': {annual:3264, semi:1673, quarterly:857, monthly:292}, '1+': {annual:3916, semi:2007, quarterly:1028, monthly:351}}},
                        single_female: {'under_40': {'0': {annual:1450, semi:743, quarterly:381, monthly:130}, '1+': {annual:1885, semi:966, quarterly:495, monthly:169}}, '40_49': {'0': {annual:1785, semi:915, quarterly:469, monthly:160}, '1+': {annual:2142, semi:1098, quarterly:562, monthly:192}}, '50_59': {'0': {annual:2266, semi:1161, quarterly:595, monthly:203}, '1+': {annual:2719, semi:1394, quarterly:714, monthly:244}}, '60_65': {'0': {annual:2669, semi:1368, quarterly:701, monthly:239}, '1+': {annual:3202, semi:1641, quarterly:841, monthly:287}}, '66_67': {'0': {annual:2935, semi:1504, quarterly:771, monthly:263}, '1+': {annual:3523, semi:1805, quarterly:925, monthly:316}}, '68_70': {'0': {annual:3069, semi:1573, quarterly:806, monthly:275}, '1+': {annual:3683, semi:1887, quarterly:967, monthly:330}}},
                        husband_wife: {'under_40': {'0': {annual:2509, semi:1286, quarterly:659, monthly:225}, '1+': {annual:3262, semi:1672, quarterly:856, monthly:292}}, '40_49': {'0': {annual:3230, semi:1656, quarterly:848, monthly:289}, '1+': {annual:3876, semi:1987, quarterly:1018, monthly:347}}, '50_59': {'0': {annual:4233, semi:2170, quarterly:1111, monthly:379}, '1+': {annual:5080, semi:2603, quarterly:1333, monthly:455}}, '60_65': {'0': {annual:4956, semi:2540, quarterly:1301, monthly:444}, '1+': {annual:5947, semi:3048, quarterly:1561, monthly:533}}, '66_67': {'0': {annual:5452, semi:2794, quarterly:1431, monthly:488}, '1+': {annual:6542, semi:3353, quarterly:1717, monthly:586}}, '68_70': {'0': {annual:5699, semi:2921, quarterly:1496, monthly:511}, '1+': {annual:6839, semi:3505, quarterly:1795, monthly:613}}},
                    },
                    '200000': {
                        single_male: {'under_40': {'0': {annual:1554, semi:796, quarterly:408, monthly:139}, '1+': {annual:2020, semi:1035, quarterly:530, monthly:181}}, '40_49': {'0': {annual:2136, semi:1094, quarterly:561, monthly:191}, '1+': {annual:2563, semi:1313, quarterly:673, monthly:230}}, '50_59': {'0': {annual:2927, semi:1500, quarterly:768, monthly:262}, '1+': {annual:3513, semi:1800, quarterly:922, monthly:315}}, '60_65': {'0': {annual:3429, semi:1757, quarterly:900, monthly:307}, '1+': {annual:4115, semi:2109, quarterly:1080, monthly:369}}, '66_67': {'0': {annual:3772, semi:1933, quarterly:990, monthly:338}, '1+': {annual:4526, semi:2320, quarterly:1188, monthly:405}}, '68_70': {'0': {annual:3943, semi:2021, quarterly:1035, monthly:353}, '1+': {annual:4732, semi:2425, quarterly:1242, monthly:424}}},
                        single_female: {'under_40': {'0': {annual:1693, semi:868, quarterly:444, monthly:152}, '1+': {annual:2201, semi:1128, quarterly:578, monthly:197}}, '40_49': {'0': {annual:2113, semi:1083, quarterly:555, monthly:189}, '1+': {annual:2536, semi:1300, quarterly:666, monthly:227}}, '50_59': {'0': {annual:2714, semi:1391, quarterly:712, monthly:243}, '1+': {annual:3257, semi:1669, quarterly:855, monthly:292}}, '60_65': {'0': {annual:3184, semi:1632, quarterly:836, monthly:285}, '1+': {annual:3821, semi:1958, quarterly:1003, monthly:342}}, '66_67': {'0': {annual:3503, semi:1795, quarterly:920, monthly:314}, '1+': {annual:4203, semi:2154, quarterly:1103, monthly:377}}, '68_70': {'0': {annual:3662, semi:1877, quarterly:961, monthly:328}, '1+': {annual:4395, semi:2252, quarterly:1154, monthly:394}}},
                        husband_wife: {'under_40': {'0': {annual:2922, semi:1497, quarterly:767, monthly:262}, '1+': {annual:3798, semi:1947, quarterly:997, monthly:340}}, '40_49': {'0': {annual:3824, semi:1960, quarterly:1004, monthly:343}, '1+': {annual:4971, semi:2548, quarterly:1305, monthly:445}}, '50_59': {'0': {annual:5078, semi:2602, quarterly:1333, monthly:455}, '1+': {annual:6601, semi:3383, quarterly:1733, monthly:591}}, '60_65': {'0': {annual:5952, semi:3050, quarterly:1562, monthly:533}, '1+': {annual:7738, semi:3966, quarterly:2031, monthly:693}}, '66_67': {'0': {annual:6547, semi:3355, quarterly:1719, monthly:587}, '1+': {annual:8511, semi:4362, quarterly:2234, monthly:762}}, '68_70': {'0': {annual:6845, semi:3508, quarterly:1797, monthly:613}, '1+': {annual:8898, semi:4560, quarterly:2336, monthly:797}}},
                    },
                    '300000': {
                        single_male: {'under_40': {'0': {annual:2530, semi:1297, quarterly:664, monthly:227}, '1+': {annual:3290, semi:1686, quarterly:864, monthly:295}}, '40_49': {'0': {annual:3112, semi:1595, quarterly:817, monthly:279}, '1+': {annual:3735, semi:1914, quarterly:980, monthly:335}}, '50_59': {'0': {annual:3904, semi:2001, quarterly:1025, monthly:350}, '1+': {annual:4685, semi:2401, quarterly:1230, monthly:420}}, '60_65': {'0': {annual:4406, semi:2258, quarterly:1157, monthly:395}, '1+': {annual:5287, semi:2710, quarterly:1388, monthly:474}}, '66_67': {'0': {annual:4846, semi:2484, quarterly:1272, monthly:434}, '1+': {annual:5816, semi:2981, quarterly:1527, monthly:521}}, '68_70': {'0': {annual:5067, semi:2597, quarterly:1330, monthly:454}, '1+': {annual:6080, semi:3116, quarterly:1596, monthly:545}}},
                        single_female: {'under_40': {'0': {annual:2670, semi:1368, quarterly:701, monthly:239}, '1+': {annual:3471, semi:1779, quarterly:911, monthly:311}}, '40_49': {'0': {annual:3090, semi:1584, quarterly:811, monthly:277}, '1+': {annual:3708, semi:1900, quarterly:973, monthly:332}}, '50_59': {'0': {annual:3691, semi:1892, quarterly:969, monthly:331}, '1+': {annual:4429, semi:2270, quarterly:1163, monthly:397}}, '60_65': {'0': {annual:4161, semi:2133, quarterly:1092, monthly:373}, '1+': {annual:4993, semi:2559, quarterly:1311, monthly:447}}, '66_67': {'0': {annual:4577, semi:2346, quarterly:1202, monthly:410}, '1+': {annual:5493, semi:2815, quarterly:1442, monthly:492}}, '68_70': {'0': {annual:4785, semi:2453, quarterly:1256, monthly:429}, '1+': {annual:5743, semi:2943, quarterly:1507, monthly:514}}},
                        husband_wife: {'under_40': {'0': {annual:4680, semi:2399, quarterly:1229, monthly:419}, '1+': {annual:6084, semi:3118, quarterly:1597, monthly:545}}, '40_49': {'0': {annual:5582, semi:2861, quarterly:1465, monthly:500}, '1+': {annual:6699, semi:3433, quarterly:1758, monthly:600}}, '50_59': {'0': {annual:6836, semi:3503, quarterly:1794, monthly:612}, '1+': {annual:8203, semi:4204, quarterly:2153, monthly:735}}, '60_65': {'0': {annual:7710, semi:3952, quarterly:2024, monthly:691}, '1+': {annual:9252, semi:4742, quarterly:2429, monthly:829}}, '66_67': {'0': {annual:8481, semi:4347, quarterly:2226, monthly:760}, '1+': {annual:10178, semi:5216, quarterly:2672, monthly:912}}, '68_70': {'0': {annual:8867, semi:4544, quarterly:2328, monthly:794}, '1+': {annual:10640, semi:5453, quarterly:2793, monthly:953}}},
                    },
                    '500000': {
                        single_male: {'under_40': {'0': {annual:2689, semi:1378, quarterly:706, monthly:241}, '1+': {annual:3495, semi:1791, quarterly:918, monthly:313}}, '40_49': {'0': {annual:3271, semi:1676, quarterly:859, monthly:293}, '1+': {annual:3925, semi:2012, quarterly:1030, monthly:352}}, '50_59': {'0': {annual:4063, semi:2082, quarterly:1066, monthly:364}, '1+': {annual:4875, semi:2499, quarterly:1280, monthly:437}}, '60_65': {'0': {annual:4564, semi:2339, quarterly:1198, monthly:409}, '1+': {annual:5477, semi:2807, quarterly:1438, monthly:491}}, '66_67': {'0': {annual:5021, semi:2573, quarterly:1318, monthly:450}, '1+': {annual:6025, semi:3088, quarterly:1581, monthly:540}}, '68_70': {'0': {annual:5249, semi:2690, quarterly:1378, monthly:470}, '1+': {annual:6299, semi:3228, quarterly:1653, monthly:564}}},
                        single_female: {'under_40': {'0': {annual:2828, semi:1449, quarterly:742, monthly:253}, '1+': {annual:3676, semi:1884, quarterly:965, monthly:329}}, '40_49': {'0': {annual:3249, semi:1665, quarterly:853, monthly:291}, '1+': {annual:3898, semi:1998, quarterly:1023, monthly:349}}, '50_59': {'0': {annual:3849, semi:1973, quarterly:1010, monthly:345}, '1+': {annual:4619, semi:2367, quarterly:1213, monthly:414}}, '60_65': {'0': {annual:4320, semi:2214, quarterly:1134, monthly:387}, '1+': {annual:5184, semi:2657, quarterly:1361, monthly:464}}, '66_67': {'0': {annual:4752, semi:2435, quarterly:1247, monthly:426}, '1+': {annual:5702, semi:2922, quarterly:1497, monthly:511}}, '68_70': {'0': {annual:4968, semi:2546, quarterly:1304, monthly:445}, '1+': {annual:5961, semi:3055, quarterly:1565, monthly:534}}},
                        husband_wife: {'under_40': {'0': {annual:4965, semi:2545, quarterly:1303, monthly:445}, '1+': {annual:6455, semi:3308, quarterly:1694, monthly:578}}, '40_49': {'0': {annual:5867, semi:3007, quarterly:1540, monthly:526}, '1+': {annual:7041, semi:3608, quarterly:1848, monthly:631}}, '50_59': {'0': {annual:7121, semi:3649, quarterly:1869, monthly:638}, '1+': {annual:8545, semi:4379, quarterly:2243, monthly:765}}, '60_65': {'0': {annual:7995, semi:4098, quarterly:2099, monthly:716}, '1+': {annual:9595, semi:4917, quarterly:2519, monthly:860}}, '66_67': {'0': {annual:8795, semi:4507, quarterly:2309, monthly:788}, '1+': {annual:10554, semi:5409, quarterly:2770, monthly:945}}, '68_70': {'0': {annual:9195, semi:4712, quarterly:2414, monthly:824}, '1+': {annual:11034, semi:5655, quarterly:2896, monthly:988}}},
                    }
                }
            };

            const healthInputs = document.querySelectorAll('#health-calculator-page select');
            
            healthInputs.forEach(input => {
                input.addEventListener('change', calculateAndDisplayHealth);
            });
            
            const generateQuoteBtn = document.getElementById('health-generate-quote-btn');
            const finalQuoteModal = document.getElementById('health-final-quote-modal');
            const closeQuoteModalBtn = document.getElementById('health-close-quote-modal-btn');
            const quoteOutput = document.getElementById('health-quote-output');
            const copyQuoteBtn = document.getElementById('health-copy-quote-btn');
            const downloadPdfBtn = document.getElementById('health-download-pdf-btn');
            let fullQuoteText = '';

            generateQuoteBtn.addEventListener('click', () => {
                generateFinalQuoteTextHealth();
                finalQuoteModal.style.display = 'flex';
            });
            closeQuoteModalBtn.addEventListener('click', () => finalQuoteModal.style.display = 'none');
            copyQuoteBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(quoteOutput.innerText).then(() => {
                    copyQuoteBtn.textContent = 'Copied!';
                    setTimeout(() => { copyQuoteBtn.textContent = 'Copy Quote'; }, 2000);
                });
            });
            downloadPdfBtn.addEventListener('click', generateAndDownloadPDFHealth);

            function getHealthElement(id) { return document.getElementById(id); }
            
            function formatCurrency(value) {
                if (typeof value !== 'number' || isNaN(value)) return 'N/A';
                return value.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            }
            
            function handleUIChangesHealth() {
                const planType = getHealthElement('health-plan-type').value;
                const familyStatus = getHealthElement('health-family-status').value;
                const ageBand = getHealthElement('health-age-band').value;
                
                const basePlanOptions = getHealthElement('health-base-plan-options');
                const majorMedicalOptions = getHealthElement('health-major-medical-options');
                const maternityContainer = getHealthElement('health-maternity-container');
                const maternitySelect = getHealthElement('health-maternity');

                basePlanOptions.style.display = (planType === 'mm_only') ? 'none' : 'block';
                majorMedicalOptions.style.display = (planType === 'base_only') ? 'none' : 'block';
                
                if ((familyStatus === 'single_female' || familyStatus === 'husband_wife') && planType !== 'mm_only') {
                    maternityContainer.style.display = 'block';
                    maternitySelect.disabled = ['50_59', '60_65', '66_67', '68_70'].includes(ageBand);
                    if (maternitySelect.disabled) maternitySelect.value = 'no';
                } else {
                    maternityContainer.style.display = 'none';
                }
            }

            function calculateAndDisplayHealth() {
                handleUIChangesHealth();

                const planType = getHealthElement('health-plan-type').value;
                const familyStatus = getHealthElement('health-family-status').value;
                const ageBand = getHealthElement('health-age-band').value;
                const childrenCount = getHealthElement('health-children-count').value;
                const maternity = getHealthElement('health-maternity').value;
                const withDV = getHealthElement('health-dental-vision').value === 'yes';
                const mmAmount = getHealthElement('health-major-medical-amount').value;
                const frequency = getHealthElement('health-payment-frequency').value;

                let baseRateSet = {annual:0, semi:0, quarterly:0, monthly:0};
                if (planType !== 'mm_only') {
                    let baseRateKey = familyStatus;
                    if (familyStatus === 'single_female' || familyStatus === 'husband_wife') {
                        baseRateKey += (maternity === 'yes' && !getHealthElement('health-maternity').disabled) ? '_with_maternity' : '_no_maternity';
                    }
                    const baseRateTable = withDV ? HEALTH_RATES.base.with_dv : HEALTH_RATES.base.standard;
                    baseRateSet = baseRateTable[baseRateKey]?.[ageBand]?.[childrenCount] || baseRateSet;
                }

                let mmRateSet = {annual:0, semi:0, quarterly:0, monthly:0};
                if (planType !== 'base_only') {
                    let mmRateKey = familyStatus;
                    if (familyStatus.startsWith('single_female')) mmRateKey = 'single_female';
                    const mmChildrenKey = (childrenCount === '0') ? '0' : '1+';
                    mmRateSet = HEALTH_RATES.major_medical[mmAmount]?.[mmRateKey]?.[ageBand]?.[mmChildrenKey] || mmRateSet;
                }

                const basePremium = baseRateSet[frequency] || 0;
                const mmPremium = mmRateSet[frequency] || 0;
                const totalPremium = basePremium + mmPremium;

                getHealthElement('health-total-premium').textContent = formatCurrency(totalPremium);
                const frequencyLabel = frequency.charAt(0).toUpperCase() + frequency.slice(1);
                getHealthElement('health-total-premium-label').textContent = `(Total ${frequencyLabel} Premium)`;
                
                let breakdownHTML = '';
                if (planType !== 'mm_only') {
                    breakdownHTML += `<p>COVERCARE Base Premium: <strong class="float-right">${formatCurrency(basePremium)}</strong></p>`;
                }
                if (planType !== 'base_only') {
                    breakdownHTML += `<p>Major Medical: <strong class="float-right">${formatCurrency(mmPremium)}</strong></p>`;
                }
                breakdownHTML += `<p class="font-bold text-lg border-t border-[var(--border-color)] pt-2 mt-2">Total ${frequencyLabel} Premium: <strong class="float-right">${formatCurrency(totalPremium)}</strong></p>`;
                getHealthElement('health-premium-breakdown').innerHTML = breakdownHTML;
                
                let comparisonHTML = `<h4 class="font-bold text-md text-[var(--text-primary)]">Payment Options</h4>`;
                comparisonHTML += `<table class="w-full mt-2 text-xs"><thead><tr class="text-left"><th class="font-semibold pb-1">Frequency</th><th class="font-semibold pb-1 text-right">Premium</th><th class="font-semibold pb-1 text-right">Saving vs. Annual</th></tr></thead><tbody>`;
                const annualTotal = (baseRateSet.annual || 0) + (mmRateSet.annual || 0);

                ['annual', 'semi', 'quarterly'].forEach(freq => {
                    const freqPremium = (baseRateSet[freq] || 0) + (mmRateSet[freq] || 0);
                    const multiplier = { annual: 1, semi: 2, quarterly: 4}[freq];
                    const effectiveAnnualCost = freqPremium * multiplier;
                    const saving = annualTotal - effectiveAnnualCost;
                    const isSelected = freq === frequency ? 'font-bold text-[var(--primary-accent)]' : '';
                    
                    comparisonHTML += `<tr class="${isSelected}">
                        <td>${freq.charAt(0).toUpperCase() + freq.slice(1)}</td>
                        <td class="text-right">${formatCurrency(freqPremium)}</td>
                        <td class="text-right">${formatCurrency(saving)}</td>
                    </tr>`;
                });
                comparisonHTML += `</tbody></table>`;
                getHealthElement('health-frequency-comparison').innerHTML = comparisonHTML;
            }

            function generateFinalQuoteTextHealth() {
                const planTypeSelect = getHealthElement('health-plan-type');
                const familyStatusSelect = getHealthElement('health-family-status');
                const ageBandSelect = getHealthElement('health-age-band');
                const childrenCountSelect = getHealthElement('health-children-count');

                const planTypeText = planTypeSelect.options[planTypeSelect.selectedIndex].text;
                const familyStatusText = familyStatusSelect.options[familyStatusSelect.selectedIndex].text;
                const ageBandText = ageBandSelect.options[ageBandSelect.selectedIndex].text;
                const childrenCountText = childrenCountSelect.options[childrenCountSelect.selectedIndex].text;
                
                let quoteDetails = `
Plan Type:          ${planTypeText}
Family Status:      ${familyStatusText}
Age Band:           ${ageBandText}
Number of Children: ${childrenCountText}
`;
                
                const planType = planTypeSelect.value;
                if (planType !== 'mm_only') {
                    const withDVText = getHealthElement('health-dental-vision').value === 'yes' ? 'Yes' : 'No';
                    const maternityEl = getHealthElement('health-maternity');
                    const maternityText = maternityEl.disabled ? 'N/A' : (maternityEl.value === 'yes' ? 'Yes' : 'No');
                    quoteDetails += `Dental & Vision:    ${withDVText}\nMaternity Included: ${maternityText}\n`;
                }
                
                if (planType !== 'base_only') {
                     const mmAmountText = formatCurrency(parseInt(getHealthElement('health-major-medical-amount').value));
                     quoteDetails += `MM Coverage:        ${mmAmountText}\n`;
                }

                const breakdownText = getHealthElement('health-premium-breakdown').innerText;
                const comparisonText = getHealthElement('health-frequency-comparison').innerText;

                fullQuoteText = `
=========================================
    OFFICIAL COVERCARE INSURANCE QUOTATION
=========================================
Date: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}

CLIENT & PLAN DETAILS:
----------------------
${quoteDetails}
PREMIUM SUMMARY:
-----------------
${breakdownText}

${comparisonText}
=========================================

This quotation is valid for 30 days.
Terms and conditions apply.
`;
                quoteOutput.textContent = fullQuoteText.trim();
            }

            function generateAndDownloadPDFHealth() {
                const clientName = getHealthElement('health-client-name').value || 'Valued Client';
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                generateFinalQuoteTextHealth();

                doc.setFont("courier", "normal");
                doc.setFontSize(10);
                doc.text(fullQuoteText, 10, 10);
                doc.save(`COVERCARE_Quote_for_${clientName.replace(/\s/g, '_')}.pdf`);
            }

            calculateAndDisplayHealth();
        })();
        // --- END OF HEALTH RATER SCRIPT ---
    });
    </script>
</body>
</html>
