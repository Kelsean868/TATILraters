<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TATIL Insurance Raters - Trinidad and Tobago</title>

    <!-- Meta tags for SEO and mobile optimization -->
    <meta name="description" content="TATIL Insurance Raters - Mobile-optimized insurance calculators for Trinidad and Tobago">
    <meta name="keywords" content="TATIL, insurance, Trinidad and Tobago, calculator, motor, property">
    <meta name="theme-color" content="#2563eb">

    <!-- Inline critical CSS to prevent loading issues -->
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--background-gradient);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .rater-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .rater-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .rater-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .rater-card.active {
            border: 2px solid var(--primary-color);
            transform: scale(1.02);
        }

        .rater-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .rater-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
            text-align: center;
        }

        .rater-description {
            color: #6b7280;
            text-align: center;
            margin-bottom: 15px;
        }

        .rater-form {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .rater-form.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            text-align: center;
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .result-container {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .result-container.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0f2fe;
        }

        .result-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary-color);
        }

        .loading-indicator {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--primary-color);
        }

        .loading-indicator.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 14px;
            z-index: 1000;
        }

        .connection-online {
            color: var(--success-color);
        }

        .connection-offline {
            color: var(--error-color);
        }

        .back-btn {
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .rater-card {
                padding: 20px;
            }

            .rater-form {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Error state styles */
        .error-message {
            background: #fef2f2;
            border: 2px solid #fca5a5;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* Success state styles */
        .success-message {
            background: #f0fdf4;
            border: 2px solid #86efac;
            color: #166534;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
        }

        .success-message.show {
            display: block;
        }
    </style>

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">

    <!-- Preload connections for better performance -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">

    <!-- Service Worker Registration (Optional) -->
    <script>
        // Only register service worker if it exists and we're not in development
        if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</head>
<body>
    <!-- Connection Status Indicator -->
    <div id="connectionStatus" class="connection-status">
        <span id="connectionText">üü¢ Online</span>
    </div>

    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>üèõÔ∏è TATIL Insurance Raters</h1>
            <p>Professional Insurance Calculators for Trinidad & Tobago</p>
        </div>

        <!-- Main Navigation -->
        <div id="mainView">
            <div class="rater-grid">
                <div class="rater-card" onclick="openRater('motor')">
                    <div class="rater-icon">üöó</div>
                    <div class="rater-title">Motor Vehicle Insurance</div>
                    <div class="rater-description">Calculate premiums for cars, SUVs, and motorcycles</div>
                </div>

                <div class="rater-card" onclick="openRater('property')">
                    <div class="rater-icon">üè†</div>
                    <div class="rater-title">Property Insurance</div>
                    <div class="rater-description">Home and building insurance calculations</div>
                </div>

                <div class="rater-card" onclick="openRater('health')">
                    <div class="rater-icon">üè•</div>
                    <div class="rater-title">Health Insurance</div>
                    <div class="rater-description">Individual and family health coverage</div>
                </div>

                <div class="rater-card" onclick="openRater('marine')">
                    <div class="rater-icon">‚õµ</div>
                    <div class="rater-title">Marine Insurance</div>
                    <div class="rater-description">Boat and vessel insurance ratings</div>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading-indicator">
            <div class="spinner"></div>
            <p>Loading calculator...</p>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message">
            <strong>Error:</strong> <span id="errorText"></span>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <strong>Success:</strong> <span id="successText"></span>
        </div>

        <!-- Dynamic Form Container -->
        <div id="raterFormContainer"></div>
    </div>

    <!-- Main JavaScript -->
    <script>
        // TATIL Insurance Raters - Simplified Version
        // This version eliminates complex resource loading and CDN dependencies

        class TATILRaters {
            constructor() {
                this.currentRater = null;
                this.initializeApp();
                this.setupConnectionMonitoring();
            }

            initializeApp() {
                console.log('TATIL Insurance Raters v2.1 - Simplified Edition');
                this.showSuccessMessage('Application loaded successfully');

                // Hide success message after 3 seconds
                setTimeout(() => {
                    this.hideMessage('successMessage');
                }, 3000);
            }

            setupConnectionMonitoring() {
                const updateConnectionStatus = () => {
                    const statusElement = document.getElementById('connectionText');
                    if (navigator.onLine) {
                        statusElement.textContent = 'üü¢ Online';
                        statusElement.className = 'connection-online';
                    } else {
                        statusElement.textContent = 'üî¥ Offline';
                        statusElement.className = 'connection-offline';
                    }
                };

                window.addEventListener('online', updateConnectionStatus);
                window.addEventListener('offline', updateConnectionStatus);
                updateConnectionStatus();
            }

            showLoading() {
                document.getElementById('loadingIndicator').classList.add('show');
            }

            hideLoading() {
                document.getElementById('loadingIndicator').classList.remove('show');
            }

            showErrorMessage(message) {
                document.getElementById('errorText').textContent = message;
                document.getElementById('errorMessage').classList.add('show');

                // Auto-hide after 5 seconds
                setTimeout(() => {
                    this.hideMessage('errorMessage');
                }, 5000);
            }

            showSuccessMessage(message) {
                document.getElementById('successText').textContent = message;
                document.getElementById('successMessage').classList.add('show');
            }

            hideMessage(messageId) {
                document.getElementById(messageId).classList.remove('show');
            }

            openRater(type) {
                this.showLoading();
                this.hideMessage('errorMessage');
                this.hideMessage('successMessage');

                try {
                    setTimeout(() => {
                        this.currentRater = type;
                        this.loadRaterForm(type);
                        this.hideLoading();
                    }, 500); // Simulate loading time
                } catch (error) {
                    this.hideLoading();
                    this.showErrorMessage('Failed to load calculator: ' + error.message);
                }
            }

            loadRaterForm(type) {
                const container = document.getElementById('raterFormContainer');
                const mainView = document.getElementById('mainView');

                mainView.style.display = 'none';

                let formHTML = '';

                switch (type) {
                    case 'motor':
                        formHTML = this.generateMotorForm();
                        break;
                    case 'property':
                        formHTML = this.generatePropertyForm();
                        break;
                    case 'health':
                        formHTML = this.generateHealthForm();
                        break;
                    case 'marine':
                        formHTML = this.generateMarineForm();
                        break;
                    default:
                        this.showErrorMessage('Unknown calculator type');
                        return;
                }

                container.innerHTML = formHTML;
                container.style.display = 'block';
            }

            generateMotorForm() {
                return \`
                    <div class="rater-form active">
                        <button class="btn btn-secondary back-btn" onclick="tatilApp.goBack()">
                            ‚Üê Back to Main Menu
                        </button>

                        <h2 style="color: var(--primary-color); margin-bottom: 25px;">
                            üöó Motor Vehicle Insurance Calculator
                        </h2>

                        <form id="motorForm" onsubmit="tatilApp.calculateMotor(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="vehicleValue">Vehicle Value (TTD)</label>
                                    <input type="number" id="vehicleValue" name="vehicleValue" 
                                           placeholder="150000" min="10000" max="5000000" required>
                                </div>

                                <div class="form-group">
                                    <label for="coverageType">Coverage Type</label>
                                    <select id="coverageType" name="coverageType" required>
                                        <option value="">Select Coverage</option>
                                        <option value="comprehensive">Comprehensive</option>
                                        <option value="thirdParty">Third Party</option>
                                        <option value="fireTheft">Fire & Theft</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="driverAge">Driver Age</label>
                                    <select id="driverAge" name="driverAge" required>
                                        <option value="">Select Age Group</option>
                                        <option value="under25">Under 25</option>
                                        <option value="25to35">25-35</option>
                                        <option value="35to50">35-50</option>
                                        <option value="over50">Over 50</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="zone">Location Zone</label>
                                    <select id="zone" name="zone" required>
                                        <option value="">Select Zone</option>
                                        <option value="portOfSpain">Port of Spain</option>
                                        <option value="sanFernando">San Fernando</option>
                                        <option value="chaguanas">Chaguanas</option>
                                        <option value="arima">Arima</option>
                                        <option value="pointFortin">Point Fortin</option>
                                        <option value="rural">Rural Areas</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="vehicleType">Vehicle Type</label>
                                    <select id="vehicleType" name="vehicleType" required>
                                        <option value="">Select Type</option>
                                        <option value="sedan">Sedan</option>
                                        <option value="suv">SUV/Jeep</option>
                                        <option value="pickup">Pickup Truck</option>
                                        <option value="hatchback">Hatchback</option>
                                        <option value="luxury">Luxury Vehicle</option>
                                        <option value="sports">Sports Car</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="excess">Excess Amount (TTD)</label>
                                    <select id="excess" name="excess" required>
                                        <option value="">Select Excess</option>
                                        <option value="2500">TTD 2,500</option>
                                        <option value="5000">TTD 5,000</option>
                                        <option value="7500">TTD 7,500</option>
                                        <option value="10000">TTD 10,000</option>
                                    </select>
                                </div>
                            </div>

                            <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                                Calculate Premium
                            </button>
                        </form>

                        <div id="motorResults" class="result-container">
                            <div class="result-title">Insurance Premium Calculation</div>
                            <div id="motorResultsContent"></div>
                        </div>
                    </div>
                \`;
            }

            generatePropertyForm() {
                return \`
                    <div class="rater-form active">
                        <button class="btn btn-secondary back-btn" onclick="tatilApp.goBack()">
                            ‚Üê Back to Main Menu
                        </button>

                        <h2 style="color: var(--primary-color); margin-bottom: 25px;">
                            üè† Property Insurance Calculator
                        </h2>

                        <form id="propertyForm" onsubmit="tatilApp.calculateProperty(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="propertyValue">Property Value (TTD)</label>
                                    <input type="number" id="propertyValue" name="propertyValue" 
                                           placeholder="500000" min="50000" max="20000000" required>
                                </div>

                                <div class="form-group">
                                    <label for="propertyType">Property Type</label>
                                    <select id="propertyType" name="propertyType" required>
                                        <option value="">Select Type</option>
                                        <option value="dwelling">Dwelling Only</option>
                                        <option value="contents">Contents Only</option>
                                        <option value="comprehensive">Dwelling & Contents</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="construction">Construction Type</label>
                                    <select id="construction" name="construction" required>
                                        <option value="">Select Construction</option>
                                        <option value="concrete">Concrete Block</option>
                                        <option value="wood">Wood Frame</option>
                                        <option value="mixed">Mixed Construction</option>
                                        <option value="steel">Steel Frame</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="roofType">Roof Type</label>
                                    <select id="roofType" name="roofType" required>
                                        <option value="">Select Roof</option>
                                        <option value="galvanize">Galvanize</option>
                                        <option value="concrete">Concrete</option>
                                        <option value="shingle">Shingle</option>
                                        <option value="tile">Clay Tile</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="propertyZone">Location</label>
                                    <select id="propertyZone" name="propertyZone" required>
                                        <option value="">Select Location</option>
                                        <option value="portOfSpain">Port of Spain</option>
                                        <option value="sanFernando">San Fernando</option>
                                        <option value="chaguanas">Chaguanas</option>
                                        <option value="eastTrinidad">East Trinidad</option>
                                        <option value="westTrinidad">West Trinidad</option>
                                        <option value="tobago">Tobago</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="securityFeatures">Security Features</label>
                                    <select id="securityFeatures" name="securityFeatures" required>
                                        <option value="">Select Security</option>
                                        <option value="basic">Basic (Locks only)</option>
                                        <option value="alarm">Alarm System</option>
                                        <option value="security">Security Service</option>
                                        <option value="comprehensive">Full Security Package</option>
                                    </select>
                                </div>
                            </div>

                            <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                                Calculate Premium
                            </button>
                        </form>

                        <div id="propertyResults" class="result-container">
                            <div class="result-title">Property Insurance Premium</div>
                            <div id="propertyResultsContent"></div>
                        </div>
                    </div>
                \`;
            }

            generateHealthForm() {
                return \`
                    <div class="rater-form active">
                        <button class="btn btn-secondary back-btn" onclick="tatilApp.goBack()">
                            ‚Üê Back to Main Menu
                        </button>

                        <h2 style="color: var(--primary-color); margin-bottom: 25px;">
                            üè• Health Insurance Calculator
                        </h2>

                        <form id="healthForm" onsubmit="tatilApp.calculateHealth(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="planType">Coverage Plan</label>
                                    <select id="planType" name="planType" required>
                                        <option value="">Select Plan</option>
                                        <option value="basic">Basic Coverage</option>
                                        <option value="standard">Standard Coverage</option>
                                        <option value="premium">Premium Coverage</option>
                                        <option value="family">Family Plan</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="memberAge">Member Age</label>
                                    <input type="number" id="memberAge" name="memberAge" 
                                           placeholder="35" min="18" max="80" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="familySize">Family Size</label>
                                    <select id="familySize" name="familySize" required>
                                        <option value="">Select Size</option>
                                        <option value="individual">Individual</option>
                                        <option value="couple">Couple</option>
                                        <option value="family3">Family of 3</option>
                                        <option value="family4">Family of 4</option>
                                        <option value="family5plus">Family of 5+</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="preExisting">Pre-existing Conditions</label>
                                    <select id="preExisting" name="preExisting" required>
                                        <option value="">Select Option</option>
                                        <option value="none">None</option>
                                        <option value="minor">Minor Conditions</option>
                                        <option value="major">Major Conditions</option>
                                        <option value="chronic">Chronic Conditions</option>
                                    </select>
                                </div>
                            </div>

                            <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                                Calculate Premium
                            </button>
                        </form>

                        <div id="healthResults" class="result-container">
                            <div class="result-title">Health Insurance Premium</div>
                            <div id="healthResultsContent"></div>
                        </div>
                    </div>
                \`;
            }

            generateMarineForm() {
                return \`
                    <div class="rater-form active">
                        <button class="btn btn-secondary back-btn" onclick="tatilApp.goBack()">
                            ‚Üê Back to Main Menu
                        </button>

                        <h2 style="color: var(--primary-color); margin-bottom: 25px;">
                            ‚õµ Marine Insurance Calculator
                        </h2>

                        <form id="marineForm" onsubmit="tatilApp.calculateMarine(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="vesselValue">Vessel Value (TTD)</label>
                                    <input type="number" id="vesselValue" name="vesselValue" 
                                           placeholder="250000" min="25000" max="10000000" required>
                                </div>

                                <div class="form-group">
                                    <label for="vesselType">Vessel Type</label>
                                    <select id="vesselType" name="vesselType" required>
                                        <option value="">Select Type</option>
                                        <option value="pleasure">Pleasure Craft</option>
                                        <option value="fishing">Fishing Vessel</option>
                                        <option value="commercial">Commercial Vessel</option>
                                        <option value="yacht">Yacht</option>
                                        <option value="speedboat">Speed Boat</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="vesselLength">Length (feet)</label>
                                    <input type="number" id="vesselLength" name="vesselLength" 
                                           placeholder="25" min="10" max="200" required>
                                </div>

                                <div class="form-group">
                                    <label for="useType">Usage Type</label>
                                    <select id="useType" name="useType" required>
                                        <option value="">Select Usage</option>
                                        <option value="recreational">Recreational</option>
                                        <option value="charter">Charter</option>
                                        <option value="commercial">Commercial</option>
                                        <option value="racing">Racing</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="waterType">Operating Waters</label>
                                    <select id="waterType" name="waterType" required>
                                        <option value="">Select Waters</option>
                                        <option value="coastal">Coastal Waters</option>
                                        <option value="offshore">Offshore</option>
                                        <option value="rivers">Rivers/Lakes</option>
                                        <option value="international">International Waters</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="experience">Captain Experience</label>
                                    <select id="experience" name="experience" required>
                                        <option value="">Select Experience</option>
                                        <option value="novice">Under 2 years</option>
                                        <option value="intermediate">2-5 years</option>
                                        <option value="experienced">5-10 years</option>
                                        <option value="expert">Over 10 years</option>
                                    </select>
                                </div>
                            </div>

                            <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                                Calculate Premium
                            </button>
                        </form>

                        <div id="marineResults" class="result-container">
                            <div class="result-title">Marine Insurance Premium</div>
                            <div id="marineResultsContent"></div>
                        </div>
                    </div>
                \`;
            }

            calculateMotor(event) {
                event.preventDefault();
                this.showLoading();

                const formData = new FormData(event.target);
                const data = Object.fromEntries(formData);

                try {
                    // Base rates for different coverage types
                    const baseRates = {
                        comprehensive: 0.045,
                        thirdParty: 0.015,
                        fireTheft: 0.025
                    };

                    // Risk factors
                    const ageFactors = {
                        under25: 1.4,
                        '25to35': 1.1,
                        '35to50': 1.0,
                        over50: 0.9
                    };

                    const zoneFactors = {
                        portOfSpain: 1.25,
                        sanFernando: 1.15,
                        chaguanas: 1.10,
                        arima: 1.05,
                        pointFortin: 1.00,
                        rural: 0.95
                    };

                    const vehicleFactors = {
                        sedan: 1.0,
                        hatchback: 0.95,
                        suv: 1.1,
                        pickup: 1.05,
                        luxury: 1.3,
                        sports: 1.5
                    };

                    const excessDiscounts = {
                        2500: 1.0,
                        5000: 0.95,
                        7500: 0.90,
                        10000: 0.85
                    };

                    const vehicleValue = parseFloat(data.vehicleValue);
                    const baseRate = baseRates[data.coverageType];
                    const ageFactor = ageFactors[data.driverAge];
                    const zoneFactor = zoneFactors[data.zone];
                    const vehicleFactor = vehicleFactors[data.vehicleType];
                    const excessDiscount = excessDiscounts[data.excess];

                    const basePremium = vehicleValue * baseRate;
                    const adjustedPremium = basePremium * ageFactor * zoneFactor * vehicleFactor * excessDiscount;

                    // Minimum premiums
                    const minimums = {
                        comprehensive: 1200,
                        thirdParty: 800,
                        fireTheft: 1000
                    };

                    const finalPremium = Math.max(adjustedPremium, minimums[data.coverageType]);

                    setTimeout(() => {
                        this.hideLoading();
                        this.displayMotorResults({
                            vehicleValue: vehicleValue,
                            coverageType: data.coverageType,
                            basePremium: basePremium,
                            finalPremium: finalPremium,
                            factors: {
                                age: ageFactor,
                                zone: zoneFactor,
                                vehicle: vehicleFactor,
                                excess: excessDiscount
                            }
                        });
                    }, 800);

                } catch (error) {
                    this.hideLoading();
                    this.showErrorMessage('Calculation error: ' + error.message);
                }
            }

            calculateProperty(event) {
                event.preventDefault();
                this.showLoading();

                const formData = new FormData(event.target);
                const data = Object.fromEntries(formData);

                try {
                    // Base rates per thousand
                    const baseRates = {
                        dwelling: 2.5,
                        contents: 3.0,
                        comprehensive: 4.5
                    };

                    const constructionFactors = {
                        concrete: 0.9,
                        wood: 1.2,
                        mixed: 1.0,
                        steel: 0.85
                    };

                    const roofFactors = {
                        galvanize: 1.1,
                        concrete: 0.9,
                        shingle: 1.05,
                        tile: 0.95
                    };

                    const zoneFactors = {
                        portOfSpain: 1.15,
                        sanFernando: 1.10,
                        chaguanas: 1.05,
                        eastTrinidad: 1.0,
                        westTrinidad: 1.0,
                        tobago: 0.95
                    };

                    const securityDiscounts = {
                        basic: 1.0,
                        alarm: 0.95,
                        security: 0.90,
                        comprehensive: 0.85
                    };

                    const propertyValue = parseFloat(data.propertyValue);
                    const baseRate = baseRates[data.propertyType] / 1000;
                    const constructionFactor = constructionFactors[data.construction];
                    const roofFactor = roofFactors[data.roofType];
                    const zoneFactor = zoneFactors[data.propertyZone];
                    const securityDiscount = securityDiscounts[data.securityFeatures];

                    const basePremium = propertyValue * baseRate;
                    const adjustedPremium = basePremium * constructionFactor * roofFactor * zoneFactor * securityDiscount;

                    const minimumPremium = 800;
                    const finalPremium = Math.max(adjustedPremium, minimumPremium);

                    setTimeout(() => {
                        this.hideLoading();
                        this.displayPropertyResults({
                            propertyValue: propertyValue,
                            propertyType: data.propertyType,
                            basePremium: basePremium,
                            finalPremium: finalPremium,
                            factors: {
                                construction: constructionFactor,
                                roof: roofFactor,
                                zone: zoneFactor,
                                security: securityDiscount
                            }
                        });
                    }, 800);

                } catch (error) {
                    this.hideLoading();
                    this.showErrorMessage('Calculation error: ' + error.message);
                }
            }

            calculateHealth(event) {
                event.preventDefault();
                this.showLoading();

                const formData = new FormData(event.target);
                const data = Object.fromEntries(formData);

                try {
                    const basePremiums = {
                        basic: 180,
                        standard: 280,
                        premium: 420,
                        family: 350
                    };

                    const ageBands = {
                        18: 1.0, 25: 1.1, 35: 1.3, 45: 1.6, 55: 2.0, 65: 2.8, 75: 3.5
                    };

                    const familyMultipliers = {
                        individual: 1.0,
                        couple: 1.8,
                        family3: 2.3,
                        family4: 2.7,
                        family5plus: 3.2
                    };

                    const conditionFactors = {
                        none: 1.0,
                        minor: 1.15,
                        major: 1.35,
                        chronic: 1.65
                    };

                    const age = parseInt(data.memberAge);
                    let ageFactor = 1.0;

                    // Find age factor
                    const ageKeys = Object.keys(ageBands).map(Number).sort((a, b) => a - b);
                    for (let i = ageKeys.length - 1; i >= 0; i--) {
                        if (age >= ageKeys[i]) {
                            ageFactor = ageBands[ageKeys[i]];
                            break;
                        }
                    }

                    const basePremium = basePremiums[data.planType];
                    const familyMultiplier = familyMultipliers[data.familySize];
                    const conditionFactor = conditionFactors[data.preExisting];

                    const monthlyPremium = basePremium * ageFactor * familyMultiplier * conditionFactor;
                    const annualPremium = monthlyPremium * 12;

                    setTimeout(() => {
                        this.hideLoading();
                        this.displayHealthResults({
                            planType: data.planType,
                            familySize: data.familySize,
                            monthlyPremium: monthlyPremium,
                            annualPremium: annualPremium,
                            factors: {
                                age: ageFactor,
                                family: familyMultiplier,
                                conditions: conditionFactor
                            }
                        });
                    }, 800);

                } catch (error) {
                    this.hideLoading();
                    this.showErrorMessage('Calculation error: ' + error.message);
                }
            }

            calculateMarine(event) {
                event.preventDefault();
                this.showLoading();

                const formData = new FormData(event.target);
                const data = Object.fromEntries(formData);

                try {
                    const baseRates = {
                        pleasure: 0.025,
                        fishing: 0.035,
                        commercial: 0.045,
                        yacht: 0.030,
                        speedboat: 0.040
                    };

                    const usageFactors = {
                        recreational: 1.0,
                        charter: 1.2,
                        commercial: 1.4,
                        racing: 1.8
                    };

                    const waterFactors = {
                        coastal: 1.0,
                        offshore: 1.3,
                        rivers: 0.8,
                        international: 1.6
                    };

                    const experienceFactors = {
                        novice: 1.4,
                        intermediate: 1.1,
                        experienced: 1.0,
                        expert: 0.9
                    };

                    const vesselValue = parseFloat(data.vesselValue);
                    const vesselLength = parseFloat(data.vesselLength);

                    const baseRate = baseRates[data.vesselType];
                    const usageFactor = usageFactors[data.useType];
                    const waterFactor = waterFactors[data.waterType];
                    const experienceFactor = experienceFactors[data.experience];

                    // Length factor (larger vessels = higher rates)
                    const lengthFactor = 1 + (vesselLength - 20) * 0.01;

                    const basePremium = vesselValue * baseRate;
                    const adjustedPremium = basePremium * usageFactor * waterFactor * experienceFactor * Math.max(lengthFactor, 0.8);

                    const minimumPremium = 1500;
                    const finalPremium = Math.max(adjustedPremium, minimumPremium);

                    setTimeout(() => {
                        this.hideLoading();
                        this.displayMarineResults({
                            vesselValue: vesselValue,
                            vesselType: data.vesselType,
                            basePremium: basePremium,
                            finalPremium: finalPremium,
                            factors: {
                                usage: usageFactor,
                                water: waterFactor,
                                experience: experienceFactor,
                                length: lengthFactor
                            }
                        });
                    }, 800);

                } catch (error) {
                    this.hideLoading();
                    this.showErrorMessage('Calculation error: ' + error.message);
                }
            }

            displayMotorResults(results) {
                const content = \`
                    <div class="result-item">
                        <span>Vehicle Value:</span>
                        <span>TTD \${results.vehicleValue.toLocaleString()}</span>
                    </div>
                    <div class="result-item">
                        <span>Coverage Type:</span>
                        <span>\${results.coverageType.charAt(0).toUpperCase() + results.coverageType.slice(1)}</span>
                    </div>
                    <div class="result-item">
                        <span>Base Premium:</span>
                        <span>TTD \${results.basePremium.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Age Factor:</span>
                        <span>\${results.factors.age}x</span>
                    </div>
                    <div class="result-item">
                        <span>Zone Factor:</span>
                        <span>\${results.factors.zone}x</span>
                    </div>
                    <div class="result-item">
                        <span>Vehicle Factor:</span>
                        <span>\${results.factors.vehicle}x</span>
                    </div>
                    <div class="result-item">
                        <span>Excess Discount:</span>
                        <span>\${results.factors.excess}x</span>
                    </div>
                    <div class="result-item">
                        <span><strong>Annual Premium:</strong></span>
                        <span><strong>TTD \${results.finalPremium.toFixed(2)}</strong></span>
                    </div>
                \`;

                document.getElementById('motorResultsContent').innerHTML = content;
                document.getElementById('motorResults').classList.add('show');

                this.showSuccessMessage('Motor insurance premium calculated successfully');
            }

            displayPropertyResults(results) {
                const content = \`
                    <div class="result-item">
                        <span>Property Value:</span>
                        <span>TTD \${results.propertyValue.toLocaleString()}</span>
                    </div>
                    <div class="result-item">
                        <span>Coverage Type:</span>
                        <span>\${results.propertyType.charAt(0).toUpperCase() + results.propertyType.slice(1)}</span>
                    </div>
                    <div class="result-item">
                        <span>Base Premium:</span>
                        <span>TTD \${results.basePremium.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Construction Factor:</span>
                        <span>\${results.factors.construction}x</span>
                    </div>
                    <div class="result-item">
                        <span>Roof Factor:</span>
                        <span>\${results.factors.roof}x</span>
                    </div>
                    <div class="result-item">
                        <span>Zone Factor:</span>
                        <span>\${results.factors.zone}x</span>
                    </div>
                    <div class="result-item">
                        <span>Security Discount:</span>
                        <span>\${results.factors.security}x</span>
                    </div>
                    <div class="result-item">
                        <span><strong>Annual Premium:</strong></span>
                        <span><strong>TTD \${results.finalPremium.toFixed(2)}</strong></span>
                    </div>
                \`;

                document.getElementById('propertyResultsContent').innerHTML = content;
                document.getElementById('propertyResults').classList.add('show');

                this.showSuccessMessage('Property insurance premium calculated successfully');
            }

            displayHealthResults(results) {
                const content = \`
                    <div class="result-item">
                        <span>Plan Type:</span>
                        <span>\${results.planType.charAt(0).toUpperCase() + results.planType.slice(1)}</span>
                    </div>
                    <div class="result-item">
                        <span>Family Size:</span>
                        <span>\${results.familySize}</span>
                    </div>
                    <div class="result-item">
                        <span>Age Factor:</span>
                        <span>\${results.factors.age}x</span>
                    </div>
                    <div class="result-item">
                        <span>Family Multiplier:</span>
                        <span>\${results.factors.family}x</span>
                    </div>
                    <div class="result-item">
                        <span>Condition Factor:</span>
                        <span>\${results.factors.conditions}x</span>
                    </div>
                    <div class="result-item">
                        <span><strong>Monthly Premium:</strong></span>
                        <span><strong>TTD \${results.monthlyPremium.toFixed(2)}</strong></span>
                    </div>
                    <div class="result-item">
                        <span><strong>Annual Premium:</strong></span>
                        <span><strong>TTD \${results.annualPremium.toFixed(2)}</strong></span>
                    </div>
                \`;

                document.getElementById('healthResultsContent').innerHTML = content;
                document.getElementById('healthResults').classList.add('show');

                this.showSuccessMessage('Health insurance premium calculated successfully');
            }

            displayMarineResults(results) {
                const content = \`
                    <div class="result-item">
                        <span>Vessel Value:</span>
                        <span>TTD \${results.vesselValue.toLocaleString()}</span>
                    </div>
                    <div class="result-item">
                        <span>Vessel Type:</span>
                        <span>\${results.vesselType.charAt(0).toUpperCase() + results.vesselType.slice(1)}</span>
                    </div>
                    <div class="result-item">
                        <span>Base Premium:</span>
                        <span>TTD \${results.basePremium.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Usage Factor:</span>
                        <span>\${results.factors.usage}x</span>
                    </div>
                    <div class="result-item">
                        <span>Water Factor:</span>
                        <span>\${results.factors.water}x</span>
                    </div>
                    <div class="result-item">
                        <span>Experience Factor:</span>
                        <span>\${results.factors.experience}x</span>
                    </div>
                    <div class="result-item">
                        <span>Length Factor:</span>
                        <span>\${results.factors.length.toFixed(2)}x</span>
                    </div>
                    <div class="result-item">
                        <span><strong>Annual Premium:</strong></span>
                        <span><strong>TTD \${results.finalPremium.toFixed(2)}</strong></span>
                    </div>
                \`;

                document.getElementById('marineResultsContent').innerHTML = content;
                document.getElementById('marineResults').classList.add('show');

                this.showSuccessMessage('Marine insurance premium calculated successfully');
            }

            goBack() {
                const container = document.getElementById('raterFormContainer');
                const mainView = document.getElementById('mainView');

                container.style.display = 'none';
                container.innerHTML = '';
                mainView.style.display = 'block';
                this.currentRater = null;

                // Clear any error/success messages
                this.hideMessage('errorMessage');
                this.hideMessage('successMessage');
            }
        }

        // Global functions
        function openRater(type) {
            tatilApp.openRater(type);
        }

        // Initialize the application
        let tatilApp;
        document.addEventListener('DOMContentLoaded', function() {
            tatilApp = new TATILRaters();
        });

        // Handle page visibility changes for better mobile performance
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                console.log('App backgrounded - pausing non-essential operations');
            } else {
                console.log('App foregrounded - resuming operations');
            }
        });
    </script>
</body>
</html>
